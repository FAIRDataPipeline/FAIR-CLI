# Check latest release of all implementations still function with new changes
name: FAIR CLI Implementation Testing
on: [push]
jobs:
  Java:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Clone Java Implementation
      uses: actions/checkout@v2
      with:
        repository: FAIRDataPipeline/javaDataPipeline
        path: java_api
        ref: 'v1.0.0-beta'
    - name: Set up JDK 11
      uses: actions/setup-java@v2
      with:
        java-version: '11'
        distribution: 'adopt'
        server-id: github
        settings-path: ${{ github.workspace }}

    - name: Build with Gradle
      run: gradle build
      working-directory: java_api
    
    - name: Install local registry
      run: |
        /bin/bash -c "$(curl -fsSL https://data.scrc.uk/static/localregistry.sh)"
    
    - uses: actions/setup-python@v2
      with:
        python-version: '3.x'
    
    - name: install fair-cli
      run: |
        pip install poetry
        poetry install
    
    - name: run javaSimpleModel with fair cli
      run: |
        poetry run fair init --ci
        poetry run fair pull src/main/resources/seirs-config.yaml
        poetry run fair run  src/main/resources/seirs-config.yaml
      working-directory: java_api